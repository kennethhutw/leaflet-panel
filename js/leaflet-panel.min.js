/*   Author: Hu Chia Wei (Kenneth) 
 +! leaflet-panel 2015-12-03 */
(function(){L.Control.PanelLayers=L.Control.Layers.extend({options:{collapsed:!1,position:"topright",autoZIndex:!0},initialize:function(a,b,c){L.setOptions(this,c),this._layers={},this._groups={},this._layersActives=[],this._lastZIndex=0,this._handlingClick=!1,this._baseLayersCtrl=[];var d,e;for(d in a)if(a[d].group&&a[d].layers)for(e in a[d].layers)this._addLayer(a[d].layers[e],!1,a[d].group);else this._addLayer(a[d],!1);for(d in b){var f=!0;if(b[d].group&&b[d].layers)for(e in b[d].layers)b[d].hasOwnProperty("marker")&&b[d].marker.hasOwnProperty("active")&&(f=b[d].marker.active),this._addLayer(b[d].layers[e],!0,b[d].group,f);else b[d].hasOwnProperty("marker")&&b[d].marker.hasOwnProperty("active")&&(f=b[d].marker.active),this._addLayer(b[d],!0,b[d].group,f)}},getfilter:function(a,b){for(i in b)if(a==b[i].layer)return b[i].filter;return null},onAdd:function(a){for(var b in this._layersActives)a.addLayer(this._layersActives[b]);return L.Control.Layers.prototype.onAdd.call(this,a),this._container},addBaseLayer:function(a,b,c){return a.name=b||a.name||"",this._addLayer(a,!1,c),this._updateLayers(),this},addOverlay:function(a,b,c){return a.name=b||a.name||"",this._addLayer(a,!0,c),this._updateLayers(),this},_addLayer:function(a,b,c,d){var e,f,g=this._instanceLayer(a.layer),h=L.stamp(g);a.active&&this._layersActives.push(g),a.marker&&a.marker.control&&(e=a.marker.control),a.marker&&a.marker.displayname&&(f=a.marker.displayname),this._layers[h]={layer:g,name:a.name,icon:a.icon,overlay:b,group:c,markertype:e,displayname:f,filter:a.filter,subcontrols:[],subfiltercontrols:[],IsActiveMarker:d},this.options.autoZIndex&&g.setZIndex&&(this._lastZIndex++,g.setZIndex(this._lastZIndex))},_instanceLayer:function(a){return a instanceof L.Class?a:a.type&&a.args?this._getPath(L,a.type).apply(window,a.args):void 0},_createItem:function(a){var b,c,d,e="leaflet-panel-layers";d=this._map.hasLayer(a.layer);var f=L.stamp(a.layer);if(a.overlay?(b=L.DomUtil.create("label",e+"-layer"),c=document.createElement("input"),c.type="checkbox",c.className="leaflet-control-layers-selector",c.defaultChecked=d,L.DomEvent.on(c,"click",this._onInputClick,this)):(b=L.DomUtil.create("label",e+"-item"),c=this._createRadioElement("leaflet-base-layers",d),c.id="base-layer"+f,L.DomEvent.on(c,"click",this._onbaselayersInputClick,this),this._baseLayersCtrl.push({id:c.id,type:"radio"})),c.setAttribute("data-layerId",f),c.layerId=L.stamp(a.layer),b.appendChild(c),a.icon){var g=L.DomUtil.create("i",e+"-icon");g.innerHTML=a.icon||"",b.appendChild(g)}var h=document.createElement("span");return h.innerHTML=" "+a.name,b.appendChild(h),b},_createMarkerItem:function(a,b){var c,d,e="leaflet-panel-layers",f=this;c=L.DomUtil.create("label",e+"-item"),d=document.createElement("span"),d.className="leaflet-control-layers-selector";document.createTextNode(" "+a.feature.properties.name);if(c.innerHTML=" "+a.feature.properties.name,c.setAttribute("data-lat",a._latlng.lat),c.setAttribute("data-lon",a._latlng.lng),c.setAttribute("data-layerid",b),c.setAttribute("data-markerid",a._leaflet_id),c.layerId=L.stamp(a),c.id="label"+c.layerId,this._layers[b].subcontrols.push({id:c.id,type:"label"}),L.DomEvent.addListener(c,"click",L.DomEvent.stopPropagation).addListener(c,"click",L.DomEvent.preventDefault).addListener(c,"click",this._onMarkerClick,this),L.DomEvent.on(c,"mouseover",function(a){f._onMarkerMouseOver(a)},this).on(c,"mouseout",function(a){f._onMarkerMouseOut(a)},this),c.appendChild(d),a.icon){var g=L.DomUtil.create("i",e+"-icon");g.innerHTML=a.icon||"",c.appendChild(g)}return c},_createMarkerDropDown:function(a){var b,c,d,e,f="leaflet-panel-layers",g=a.layer,h=a.name,i=L.stamp(g);a.displayname&&(h=a.displayname),d=L.DomUtil.create("legend",f+"-grouplabel"),e=document.createElement("span"),e.innerHTML=" "+h,d.id=h.toLowerCase(),d.appendChild(e),b=L.DomUtil.create("select",f+"-item"),b.id="dropdown"+i,this._layers[i].subcontrols.push({id:b.id,type:"dropdown"});for(var j in g._layers)if(g._layers[j].feature){var c=document.createElement("option");c.value=g._layers[j].feature.properties.name,c.text=g._layers[j].feature.properties.name,c.setAttribute("data-lat",g._layers[j]._latlng.lat),c.setAttribute("data-lon",g._layers[j]._latlng.lng),b.appendChild(c)}return L.DomEvent.addListener(b,"change",L.DomEvent.stopPropagation).addListener(b,"change",L.DomEvent.preventDefault).addListener(b,"change",this._onMarkerChange,this),d.appendChild(b),d},_createMarkerAccordion:function(a){var b,c,d=(a.name,a.name),e=a.layer;b=L.DomUtil.create("ul","leaflet-panel-layers-accordion");var f=L.stamp(e);a.displayname&&(d=a.displayname),b.id="accordion"+f,this._layers[f].subcontrols.push({id:b.id,type:"accordion"}),c=document.createElement("li"),c.innerHTML=" "+d,L.DomEvent.addListener(c,"click",L.DomEvent.stopPropagation).addListener(c,"click",L.DomEvent.preventDefault).addListener(c,"click",this._onAccordionClick,this),b.appendChild(c),ul=L.DomUtil.create("ul");for(var g in e._layers)if(e._layers[g].feature&&e._layers[g].feature.properties){var c=document.createElement("li"),h=document.createElement("a");h.innerHTML=e._layers[g].feature.properties.name,h.setAttribute("href","#"),c.setAttribute("data-lat",e._layers[g]._latlng.lat),c.setAttribute("data-lon",e._layers[g]._latlng.lng),h.setAttribute("data-lat",e._layers[g]._latlng.lat),h.setAttribute("data-lon",e._layers[g]._latlng.lng),h.id=b.id+"_"+g,this._layers[f].subcontrols.push({id:h.id,type:"accordion_li"}),L.DomEvent.addListener(h,"click",L.DomEvent.stopPropagation).addListener(h,"click",L.DomEvent.preventDefault).addListener(h,"click",this._onMarkerClick,this),c.appendChild(h),ul.appendChild(c)}return b.appendChild(ul),b},_createMarkerAccordionCheckbox:function(a){var b,c,d,e=(a.name,a.name),f=a.layer;b=L.DomUtil.create("ul","leaflet-panel-layers-accordion");var g=L.stamp(f);a.displayname&&(e=a.displayname),b.id="accordion"+g,this._layers[g].subcontrols.push({id:b.id,type:"accordion"}),d=document.createElement("li"),d.innerHTML=" "+e,L.DomEvent.addListener(d,"click",L.DomEvent.stopPropagation).addListener(d,"click",L.DomEvent.preventDefault).addListener(d,"click",this._onAccordionClick,this),b.appendChild(d),ul=L.DomUtil.create("ul");for(var h in f._layers)if(f._layers[h].feature&&f._layers[h].feature.properties){var d=document.createElement("li");c=document.createElement("input"),c.type="checkbox",c.className="leaflet-control-layers-selector",c.layerId=g,c.setAttribute("data-layerId",g),c.setAttribute("data-markername",f._layers[h].feature.properties.name),c.setAttribute("data-markerid",f._layers[h]._leaflet_id),L.DomEvent.on(c,"click",this._onAccordionCheckBoxClick,this),c.defaultChecked=!0;var i=document.createElement("a");i.innerHTML=f._layers[h].feature.properties.name,i.setAttribute("href","#"),i.setAttribute("onclick","map.panTo( new L.LatLng("+f._layers[h]._latlng.lat+", "+f._layers[h]._latlng.lng+" ) );return true;"),d.setAttribute("data-lat",f._layers[h]._latlng.lat),d.setAttribute("data-lon",f._layers[h]._latlng.lng),i.id=b.id+"_"+h,this._layers[g].subcontrols.push({id:i.id,type:"accordion_li"}),d.appendChild(c),d.appendChild(i),ul.appendChild(d)}return b.appendChild(ul),b},_onMarkerMouseOver:function(a){var b=(a.currentTarget,a.currentTarget.getAttribute("data-layerid")),c=this._layers[b],d=a.currentTarget.getAttribute("data-markerid");for(ml in this._map._layers){var e=this._map._layers[ml];e.feature&&e.options.title.toLowerCase()==c.name.toLowerCase()&&e._leaflet_id==d&&(e._icon.style.backgroundColor="#08f",e._icon.style.cursor="#08f")}},_onMarkerMouseOut:function(a){var b=(a.currentTarget,a.currentTarget.getAttribute("data-layerid")),c=this._layers[b],d=a.currentTarget.getAttribute("data-markerid");for(ml in this._map._layers){var e=this._map._layers[ml];e.feature&&e.options.title.toLowerCase()==c.name.toLowerCase()&&e._leaflet_id==d&&(e._icon.style.backgroundColor="")}},_onAccordionCheckBoxClick:function(a){var b=a.currentTarget,c=a.currentTarget.getAttribute("data-layerid"),d=this._layers[c],e=(a.currentTarget.getAttribute("data-markername"),a.currentTarget.getAttribute("data-markerid"));for(ml in this._map._layers){var f=this._map._layers[ml];f.feature&&f.options.title.toLowerCase()==d.name.toLowerCase()&&f._leaflet_id==e&&(b.checked?f._icon.style.display="":f._icon.style.display="none")}},_onAccordionClick:function(a){var b=a.currentTarget;$(b).next().slideToggle(300)},_createFilterDropDown:function(a,b,c){var d,e,f,g,h="leaflet-panel-layers";f=L.DomUtil.create("legend",h+"-grouplabel"),g=document.createElement("span"),g.innerHTML=" "+b,f.id=c.toLowerCase(),f.appendChild(g),d=L.DomUtil.create("select",h+"-item"),d.setAttribute("data-layerId",a._leaflet_id);var i=[];for(var j in a._layers)if(a._layers[j].feature&&a._layers[j].feature.properties){var k=a._layers[j].feature.properties[b];-1==i.indexOf(k)&&i.push(a._layers[j].feature.properties[b]),d.setAttribute("data-layer",a._layers[j]._latlng.lat)}d.id="Filter"+b+a._leaflet_id,d.setAttribute("data-field",b);var l=L.stamp(a);this._layers[l].subfiltercontrols.push({id:d.id,type:"dropdown",field:b});var m=document.createElement("option");m.value="All",m.text="All",m.id=b,d.appendChild(m);for(var j in i){var e=document.createElement("option");e.value=i[j],e.text=i[j],e.id=b,d.appendChild(e)}return f.appendChild(d),L.DomEvent.addListener(d,"change",L.DomEvent.stopPropagation).addListener(d,"change",L.DomEvent.preventDefault).addListener(d,"change",this._onDropDownFilter,this),f},_createFilterCheckBox:function(a,b,c){var d,e,f,g,h="leaflet-panel-layers";d=L.DomUtil.create("legend",h+"-grouplabel"),e=document.createElement("span"),e.innerHTML=" "+b,d.appendChild(e);var i=[];for(var j in a._layers)if(a._layers[j].feature){var k=a._layers[j].feature.properties[b];-1==i.indexOf(k)&&i.push(a._layers[j].feature.properties[b])}var l=L.stamp(a);d.id="Filter"+b+l;for(var j in i){g=L.DomUtil.create("label",h+"-item"),f=document.createElement("input"),f.type="checkbox",f.className="leaflet-control-layers-selector",f.defaultChecked="true";var e=document.createElement("span");e.innerHTML=" "+i[j],f.id="Filter"+b+"Ctrl"+j,f.value=i[j],f.setAttribute("data-layerId",L.stamp(a)),f.setAttribute("data-field",b),f.setAttribute("data-layername",c),this._layers[l].subfiltercontrols.push({id:f.id,type:"checkbox",field:b}),g.appendChild(f),g.appendChild(e),L.DomEvent.addListener(f,"change",L.DomEvent.stopPropagation).addListener(f,"change",L.DomEvent.preventDefault).addListener(f,"change",this._onCheckBoxFilter,this),d.appendChild(g)}return d},_createFilterRadio:function(a,b){var c,d,e,f,g="leaflet-panel-layers";c=L.DomUtil.create("legend",g+"-grouplabel"),d=document.createElement("span"),d.innerHTML=" "+b,c.appendChild(d),c.setAttribute("data-layerId",L.stamp(a));var h=[];for(var i in a._layers)if(a._layers[i].feature&&a._layers[i].feature.properties){var j=a._layers[i].feature.properties[b];-1==h.indexOf(j)&&h.push(a._layers[i].feature.properties[b])}c.id="FilterRadio"+b;var k=L.stamp(a);this._layers[k].subfiltercontrols.push({id:c.id,type:"radio",field:b}),f=L.DomUtil.create("label",g+"-item"),e=this._createRadioElement(c.id+"option",!0),e.setAttribute("data-layerId",L.stamp(a));var d=document.createElement("span");d.innerHTML=" All",e.id=b+"Ctrl",e.value="All",f.appendChild(e),f.appendChild(d),c.appendChild(f);for(var i in h){f=L.DomUtil.create("label",g+"-item"),e=this._createRadioElement(c.id+"option",!1);var d=document.createElement("span");d.innerHTML=" "+h[i],e.id=b+"Ctrl"+i,e.value=h[i],f.appendChild(e),f.appendChild(d),this._layers[k].subfiltercontrols.push({id:e.id,type:"radio",field:b}),c.appendChild(f)}return L.DomEvent.addListener(c,"change",L.DomEvent.stopPropagation).addListener(c,"change",L.DomEvent.preventDefault).addListener(c,"change",this._onRadioFilter,this),c},_createFilterAccordionCheckBox:function(a,b,c){var d,e,f,g="leaflet-panel-layers";d=L.DomUtil.create("ul","leaflet-panel-layers-accordion");var h=L.stamp(a);d.id="accordion"+h,f=document.createElement("li"),f.innerHTML=" "+b,L.DomEvent.addListener(f,"click",L.DomEvent.stopPropagation).addListener(f,"click",L.DomEvent.preventDefault).addListener(f,"click",this._onAccordionClick,this),d.appendChild(f),ul=L.DomUtil.create("ul");var i=[];for(var j in a._layers)if(a._layers[j].feature&&a._layers[j].feature.properties){var k=a._layers[j].feature.properties[b];-1==i.indexOf(k)&&i.push(a._layers[j].feature.properties[b])}for(var j in i){var f=document.createElement("li");label=L.DomUtil.create("label",g+"-item"),e=document.createElement("input"),e.type="checkbox",e.className="leaflet-control-layers-selector",e.defaultChecked="true";var l=document.createElement("span");l.innerHTML=" "+i[j],e.id="Filter"+b+"Ctrl"+j,e.value=i[j],e.setAttribute("data-layerId",L.stamp(a)),e.setAttribute("data-field",b),e.setAttribute("data-layername",c),f.appendChild(e),f.appendChild(l),ul.appendChild(f),this._layers[h].subfiltercontrols.push({id:e.id,type:"accordioncheckbox",field:b}),L.DomEvent.addListener(e,"change",L.DomEvent.stopPropagation).addListener(e,"change",L.DomEvent.preventDefault).addListener(e,"change",this._onCheckBoxFilter,this)}return d.appendChild(ul),d},_CheckBoxFilter:function(a,b,c,d){if(a.feature.properties[b]){var e=document.getElementById(c);e.checked?e.value==a.feature.properties[b]&&(a._icon.style.display="",this._subfilter(a,d,this)):e.value==a.feature.properties[b]&&(a._icon.style.display="none")}},_onCheckBoxFilter:function(a){this._handlingClick=!0;var b=a.currentTarget,c=a.currentTarget.getAttribute("data-layerid"),d=a.currentTarget.getAttribute("data-field"),e=a.currentTarget.getAttribute("data-layername"),f=this.unset(this._layers[c].subfiltercontrols,b.id);for(ml in this._map._layers)this._map._layers[ml].feature&&this._map._layers[ml].options.title.toLowerCase()==e.toLowerCase()&&this._CheckBoxFilter(this._map._layers[ml],d,b.id,f)},_RadioFilter:function(a,b,c,d){var e=[],f=[];if(a.feature.properties[b]){var g=document.getElementById(c),h="";for(index in g.childNodes)if(g.childNodes[index].childNodes[0].checked){h=g.childNodes[index].childNodes[0].value;break}"all"==h.toLowerCase()?(e.push(a),f.push(JSON.stringify(a.toGeoJSON())),a._icon.style.display="",this._subfilter(a,d,this)):a.feature.properties[b].toLowerCase()==h.toLowerCase()?(e.push(a),f.push(JSON.stringify(a.toGeoJSON())),a._icon.style.display="",this._subfilter(a,d,this)):a._icon.style.display="none"}},_onRadioFilter:function(a){this._handlingClick=!0;var b=a.currentTarget,c=a.currentTarget.getAttribute("data-layerid"),d=this.unset(this._layers[c].subfiltercontrols,b.id);for(ml in this._map._layers)this._map._layers[ml].feature&&this._map._layers[ml].options.title&&this._map._layers[ml].options.title.toLowerCase()==b.parentElement.id.toLowerCase()&&this._RadioFilter(this._map._layers[ml],b.id.substring(11),b.id,d)},_DropDownFilter:function(a,b,c,d){if(a.feature.properties[b]){var e=document.getElementById(c);"all"==e.value.toLowerCase()?(a._icon.style.display="",that._subfilter(a,d,that)):a.feature.properties[b].toLowerCase()==e.value.toLowerCase()?a._icon.style.display="":a._icon.style.display="none"}},_onDropDownFilter:function(a){this._handlingClick=!0;var b=a.currentTarget,c=a.currentTarget.getAttribute("data-layerid"),d=a.currentTarget.getAttribute("data-field"),e=this.unset(this._layers[c].subfiltercontrols,b.id),f=this;$.each(this._map._layers,function(a){var c=this._map._layers[a];c.feature&&c.options.title.toLowerCase()==b.parentElement.id.toLowerCase()&&c.feature.properties[d]&&("all"==b.value.toLowerCase()?(c._icon.style.display="",f._subfilter(c,e,f)):c.feature.properties[d].toLowerCase()==b.value.toLowerCase()?(c._icon.style.display="",f._subfilter(c,e,f)):c._icon.style.display="none")}),this._handlingClick=!1},_onMarkerChange:function(a){this._handlingClick=!0;for(var b in a.currentTarget)if(a.currentTarget[b].selected){var c=a.currentTarget[b].getAttribute("data-lat"),d=a.currentTarget[b].getAttribute("data-lon");this._map.panTo(new L.LatLng(c,d));break}this._handlingClick=!1},_addItem:function(a){var b,c,d="leaflet-panel-layers",e=a.overlay?this._overlaysList:this._baseLayersList;if(a.group){if(!this._groups[a.group]){this._groups[a.group]=L.DomUtil.create("fieldset",d+"-group",e),b=L.DomUtil.create("legend",d+"-grouplabel");var f=document.createElement("span");f.innerHTML=" "+a.group,this._groups[a.group].id=a.group,b.appendChild(f),this._groups[a.group].appendChild(b)}e=this._groups[a.group],b=this._createItem(a),e.appendChild(b)}else b=this._createItem(a),e.appendChild(b);if(a.layer){if(a.group){if(!this._groups[a.group]){var g=a.name;a.displayname&&(g=a.displayname),this._groups[a.group]=L.DomUtil.create("fieldset",d+"-group",e),this._groups[a.group].name=a.name,b=L.DomUtil.create("legend",d+"-grouplabel");var f=document.createElement("span");f.innerHTML=" "+g,b.appendChild(f),this._groups[a.group].appendChild(b)}e=this._groups[a.group]}c=a.layer.active,void 0==c&&(c=!1);var h=this;if(a.IsActiveMarker)if(a.markertype)if("dropdown"==a.markertype.toLowerCase()){var i=h._createMarkerDropDown(a);e.appendChild(i)}else if("accordion"==a.markertype.toLowerCase()){var j=h._createMarkerAccordion(a);e.appendChild(j)}else if("accordioncheckbox"==a.markertype.toLowerCase()){var j=h._createMarkerAccordionCheckbox(a);e.appendChild(j)}else if("button"==a.markertype.toLowerCase()){var k=L.stamp(a.layer);Object.keys(a.layer._layers).forEach(function(c){a.layer._layers[c].feature&&(b=h._createMarkerItem(a.layer._layers[c],k),e.appendChild(b))})}else{var k=L.stamp(a.layer);Object.keys(a.layer._layers).forEach(function(c){a.layer._layers[c].feature&&(b=h._createMarkerItem(a.layer._layers[c],k),e.appendChild(b))})}else{var k=L.stamp(a.layer);Object.keys(a.layer._layers).forEach(function(c){a.layer._layers[c].feature&&(b=h._createMarkerItem(a.layer._layers[c],k),e.appendChild(b))})}if(a.filter)for(var l in a.filter){var i=this.addFilterItem(a,l);e.appendChild(i)}}return b},addFilterItem:function(a,b){var c;if(a.filter[b].type)switch(a.filter[b].type.toLowerCase()){case"dropdown":c=this._createFilterDropDown(a.layer,a.filter[b].field,a.name);break;case"checkbox":c=this._createFilterCheckBox(a.layer,a.filter[b].field,a.name);break;case"radio":c=this._createFilterRadio(a.layer,a.filter[b].field,a.name);break;case"accordioncheckbox":var c=this._createFilterAccordionCheckBox(a.layer,a.filter[b].field,a.name)}return c},_onbaselayersInputClick:function(a){var b,c,d,e,f=this._baseLayersCtrl.length;for(this._handlingClick=!0,b=0;f>b;b++)c=document.getElementById(this._baseLayersCtrl[b].id),e=c.getAttribute("data-layerid"),d=this._layers[e],c.checked&&!this._map.hasLayer(d.layer)?this._map.addLayer(d.layer):!c.checked&&this._map.hasLayer(d.layer)&&this._map.removeLayer(d.layer);this._handlingClick=!1,this._refocusOnMap()},_onInputClick:function(a){var b,c,b=a.currentTarget,d=a.currentTarget.getAttribute("data-layerid");if(this._handlingClick=!0,c=this._layers[d])if(b.checked&&!this._map.hasLayer(c.layer)){for(k in c.subcontrols){var e=document.getElementById(c.subcontrols[k].id);switch(c.subcontrols[k].type){case"accordion_li":e.style.pointerEvents="auto";break;case"dropdown":e.disabled=!1;break;case"label":e.disabled=!1,L.DomEvent.addListener(e,"click",L.DomEvent.stopPropagation).addListener(e,"click",L.DomEvent.preventDefault).addListener(e,"click",this._onMarkerClick,this)}}for(s in c.subfiltercontrols){var f=document.getElementById(c.subfiltercontrols[s].id);switch(c.subfiltercontrols[s].type){case"checkbox":f.disabled=!1;break;case"dropdown":f.disabled=!1;break;case"radio":f.disabled=!1,L.DomEvent.addListener(f,"click",L.DomEvent.stopPropagation).addListener(f,"click",L.DomEvent.preventDefault).addListener(f,"click",this._onRadioFilter,this)}}this._map.addLayer(c.layer)}else if(!b.checked&&this._map.hasLayer(c.layer)){this._map.removeLayer(c.layer);for(k in c.subcontrols){var e=document.getElementById(c.subcontrols[k].id);switch(c.subcontrols[k].type){case"accordion_li":e.style.pointerEvents="none";break;case"dropdown":e.disabled=!0;break;case"label":L.DomEvent.removeListener(e,"click",L.DomEvent.stopPropagation).removeListener(e,"click",L.DomEvent.preventDefault).removeListener(e,"click",this._onMarkerClick,this)}}for(s in c.subfiltercontrols){var f=document.getElementById(c.subfiltercontrols[s].id);switch(c.subfiltercontrols[s].type){case"checkbox":f.disabled=!0;break;case"dropdown":f.disabled=!0;break;case"radio":f.disabled=!0,L.DomEvent.removeListener(f,"click",L.DomEvent.stopPropagation).removeListener(f,"click",L.DomEvent.preventDefault).removeListener(f,"click",this._onRadioFilter,this)}}}this._handlingClick=!1,this._refocusOnMap()},_onMarkerClick:function(a){this._handlingClick=!0;var b=a.currentTarget.getAttribute("data-lat"),c=a.currentTarget.getAttribute("data-lon");this._map.panTo(new L.LatLng(b,c)),this._handlingClick=!1},_subfilter:function(a,b,c){b&&b.length>0&&$.each(b,function(d){switch(b[d].type){case"radio":c._RadioFilter(a,b[d].field,b[d].id);break;case"checkbox":c._CheckBoxFilter(a,b[d].field,b[d].id);break;case"dropdown":c._DropDownFilter(a,b[d].field,b[d].id)}})},_initLayout:function(){var a="leaflet-panel-layers",b=this._container=L.DomUtil.create("div",a);b.setAttribute("aria-haspopup",!0),b.style.height=this._map.getSize().y+"px",this._map.on("resize",function(a){b.style.height=a.newSize.y+"px"});var c=this._form=L.DomUtil.create("form",a+"-list");if(this.options.collapsed){L.Browser.android||L.DomEvent.on(b,"mouseover",this._expand,this).on(b,"mouseout",this._collapse,this);var d=this._layersLink=L.DomUtil.create("a",a+"-toggle",b);d.href="#",d.title="Layers",L.Browser.touch?L.DomEvent.on(d,"click",L.DomEvent.stop).on(d,"click",this._expand,this):L.DomEvent.on(d,"focus",this._expand,this),this._map.on("click",this._collapse,this)}else this._expand();this._baseLayersList=L.DomUtil.create("div",a+"-base",c),this._separator=L.DomUtil.create("div",a+"-separator",c),this._overlaysList=L.DomUtil.create("div",a+"-overlays",c),b.appendChild(c)},_expand:function(){L.DomUtil.addClass(this._container,"leaflet-panel-layers-expanded")},_collapse:function(){this._container.className=this._container.className.replace(" leaflet-panel-layers-expanded","")},_getPath:function(a,b){var c=b.split("."),d=c.pop(),e=c.length,f=c[0],g=1;if(e>0)for(;(a=a[f])&&e>g;)f=c[g++];return a?a[d]:void 0},unset:function(a,b){var c=[],d=this;return $.each(a,function(e){a[e].id!=b&&d.stringStartWith(a[e].id,"Filter")&&c.push(a[e])}),c},stringStartWith:function(a,b){return a.slice(0,b.length)==b}}),L.Control.panelLayers=function(a,b,c){return console.log("panelLayers"),new L.Control.PanelLayers(a,b,c)}}).call(this);